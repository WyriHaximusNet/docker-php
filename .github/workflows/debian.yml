name: Debian
on:
  workflow_dispatch:
  push:
    branches:
      - master
  pull_request:
  schedule:
    - cron:  '13 4 * * *'
jobs:
  supported-debian-versions:
    name: Supported Debian versions
    runs-on: ubuntu-latest
    outputs:
      debian: ${{ steps.supported-debian-versions.outputs.versions }}
    steps:
      - id: supported-debian-versions
        name: Generate Debian
        uses: wyrihaximus/github-action-supported-debian-linux-versions@v1
  secret-passthrough:
    name: Secret Passthrough
    runs-on: ubuntu-latest
    outputs:
      docker_user: ${{ steps.passthrough.outputs.docker_user }}
      ghcr_token: ${{ steps.passthrough.outputs.ghcr_token }}
      hub_passcode: ${{ steps.passthrough.outputs.hub_passcode }}
    steps:
      - id: passthrough
        name: Passthrough
        run: |
          echo "docker_user=${{ secrets.HUB_USERNAME }}" >> $GITHUB_OUTPUT
          echo "ghcr_token=${{ secrets.GHCR_TOKEN }}" >> $GITHUB_OUTPUT
          echo "docker_user=${{ secrets.HUB_PASSCODE }}" >> $GITHUB_OUTPUT
  ci:
    needs:
      - supported-debian-versions
      - secret-passthrough
    name: Continuous Integration
    uses: ./.github/workflows/ci.yml
    with:
      alpine: "[]"
      debian: ${{ needs.supported-debian-versions.outputs.debian }}
      docker_user: ${{ needs.secret-passthrough.outputs.docker_user }}
      ghcr_token: ${{ needs.secret-passthrough.outputs.ghcr_token }}
      hub_passcode: ${{ needs.secret-passthrough.outputs.hub_passcode }}
